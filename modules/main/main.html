<div ng-class="{ 'main-container': 1, playing: timeline.isPlaying(), paused: !timeline.isPlaying() }">

  <nav>
    <div class="top">
      <span ng-show="getScriptCount()">
        <select ng-model="programState.currentScript">
          <option ng-repeat="(script, log) in timeline.programState.scripts" value="{{script}}">{{script}}</option>
        </select>
        <button ng-show="getCurrentScript().modified" ng-click="abandonChanges()" title="Abandon changes.">X</button>
        <span class="parse error message">{{getCurrentScript().parseError.message}}</span>
      </span>

      <a class="github" href="https://github.com/omphalos/earhorn" title="View the source at github.com.">GitHub</a>
    </div>

    <div class="timeline">
      <div class="status">
        <!--span title="Fast Backward" class="fast-backward icon" ng-click="timeline.fastBackward()"></span>
        <span title="Step Backward" class="step-backward icon" ng-click="timeline.stepBackward()"></span-->
        <span title="Pause" class="pause icon" ng-class="{ active: !timeline.isPlaying() }" ng-click="timeline.pause()"></span>
        <span title="Play" class="play icon" ng-class="{ active: timeline.isPlaying() }" ng-click="timeline.play()"></span>
        <!--span title="Step Forward" class="step-forward icon" ng-click="timeline.stepForward()"></span>
        <span title="Fast Forward" class="fast-forward icon" ng-click="timeline.fastForward()"></span-->
      </div>
      <div class="input-container">
        <input type="range" min="0" max="{{timeline.history.length - 1}}" ng-model="timelinePosition">
      </div>
    </div>

    <!--span class="error">
      <span title="Go to error" class="error icon"></span>
    </span-->

  </nav>

  <div class="main-content" ng-click="widgetKey = null">
    <editor
      ng-class="{ full: !iframe, half: !!iframe }"
      code="code"
      line="currentLine"
      ch="currentCh"
      init-autofocus="true"
      init-style-active-line="true"
      init-mode="text/javascript"
      init-full-screen="true"
      init-line-numbers="true"
      bookmarks="getBookmarks()"
      bookmark-template="bookmarkTemplate"
      widget-line="widgetLine"
      widget-ch="widgetCh"
      widget-template="widgetTemplate"
      markers="getMarkers()"
      element="editor"/>
    <iframe ng-if="!!iframe" src="{{iframe}}">IFRAME</iframe>
    <!--iframe ng-if="!iframe">
      <html>
      <body>
        <script>console.log('sandbox')</script>
        <script src="sandbox.js"></script>
      </body>
      </html>
    </iframe-->
  </div>

  <script type="text/ng-template" id="bookmarkTemplate">
    <span
      ng-mouseenter="hover(key,log.loc)"
      ng-mouseleave="unhover()"
      ng-class="{ bookmark: 1, current: key == programState.currentLoc}"
      ng-click="toggleWidget($event, key)">{{getLogText(log.val)}}</span>
  </script>

  <script type="text/ng-template" id="widgetTemplate">
    <span ng-show="getWidgetLog() && widgetScript == programState.currentScript" class="widget">
      <div ng-if="getWidgetLog()" class="widget-inner {{getWidgetLog().type}}">
        <!-- TODO: use ng-switch -->

        <!-- Object widgets -->
        <span ng-if="getWidgetLog().val.type == 'Object'">
          <div ng-repeat="(key, value) in getWidgetLog().val.properties" title="value.type">
            <span class="widget-label {{value.type}}">
              {{key}}<span ng-if="value.type == 'Function'">()</span>
            </span>
            <span class="widget-separator">: </span>
            <span class="widget-value {{value.type}}">{{getLogText(value, key)}}</span>
          </div>
          <div ng-if="!getWidgetLog().val.complete">...</div>
        </span>

        <!-- Array widgets -->
        <span ng-if="getWidgetLog().val.type == 'Array'">
          <div ng-repeat="(key, value) in getWidgetLog().val.elements" title="value.type">
            <span class="widget-label {{value.type}}">
              {{key}}<span ng-if="value.type == 'Function'">()</span>
            </span>
            <span class="widget-separator">: </span>
            <span class="widget-value {{value.type}}">{{getLogText(value)}}</span>
          </div>
          <div ng-if="!getWidgetLog().val.elements.length">{{getWidgetLog().val.type}}</div>
          <div ng-if="getWidgetLog().val.length !== getWidgetLog().val.elements.length">...</div>
        </span>

        <!-- Other widgets -->
        <span ng-if="getWidgetLog().val.type !== 'Object' && getWidgetLog().val.type !== 'Array'">
          {{getWidgetLog().val.type}}
        </span>
      </div>
    </span>
  </script>

</div>